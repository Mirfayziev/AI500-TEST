{% extends "base.html" %}
{% block content %}

<style>

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 22px;
    margin-bottom: 25px;
}

.kpi-card {
    background: linear-gradient(180deg,#111827,#0e1525);
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 0 18px rgba(0,0,0,0.45);
    border: 1px solid rgba(255,255,255,0.05);
}

.kpi-title {
    font-size: 15px;
    opacity: .75;
    margin-bottom: 5px;
}

.kpi-number {
    font-size: 38px;
    font-weight: 700;
}

.section-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 22px;
    margin-bottom: 28px;
}

.card {
    background: rgba(255,255,255,0.05);
    padding: 26px;
    border-radius: 18px;
    backdrop-filter: blur(10px);
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.06);
}

.card-title {
    font-size: 18px;
    margin-bottom: 18px;
    font-weight: 600;
}

.tasks-list div {
    margin-bottom: 14px;
    font-size: 15px;
}

.bottom-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 22px;
}

/* CANVAS FIX */
.chart-box {
    width: 100%;
    height: 270px;
    position: relative;
}

</style>

<h1 style="margin-bottom: 25px;">AF Imperiya — Rahbar Paneli</h1>

<!-- ========== KPI SECTION ========== -->
<div class="dashboard-grid">

    <div class="kpi-card">
        <div class="kpi-title">Jami topshiriqlar</div>
        <div class="kpi-number">{{ total_tasks }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-title">Bajarilgan</div>
        <div class="kpi-number" style="color:#22c55e;">{{ completed }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-title">Kechikkan</div>
        <div class="kpi-number" style="color:#ef4444;">{{ overdue }}</div>
    </div>

    <div class="kpi-card">
        <div class="kpi-title">Yangi topshiriqlar</div>
        <div class="kpi-number" style="color:#3b82f6;">{{ new_tasks }}</div>
    </div>

</div>


<!-- ========== SECTION 2 ========== -->
<div class="section-grid">

    <div class="card">
        <div class="card-title">Tasks Overview</div>

        <div class="tasks-list">
            {% for task in top_users %}
            <div>
                <b>{{ task.user }}</b> — {{ task.count }}
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="card">
        <div class="card-title">Xodimlar Faolligi</div>
        <div class="chart-box">
            <canvas id="employeeChart"></canvas>
        </div>
    </div>

</div>



<!-- ========== SECTION 3 ========== -->
<div class="bottom-grid">

    <div class="card">
        <div class="card-title">Task Priorities</div>
        <div class="chart-box">
            <canvas id="priorityChart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="card-title">Quyosh panellari</div>
        <div class="chart-box">
            <canvas id="solarChart"></canvas>
        </div>
    </div>

    <div class="card">
        <div class="card-title">Xodimlar Ish Haqi Statistikasi</div>
        <div class="chart-box">
            <canvas id="salaryChart"></canvas>
        </div>
    </div>

</div>



<!-- ================== SCRIPT PART ================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

/***********************
  EMPLOYEE ACTIVITY CHART
************************/
const ctx = document.getElementById("employeeChart").getContext("2d");

let gradient = ctx.createLinearGradient(0,0,0,300);
gradient.addColorStop(0, "rgba(59,130,246,0.55)");
gradient.addColorStop(1, "rgba(59,130,246,0.05)");

new Chart(ctx, {
    type: "line",
    data: {
        labels: ["Dsh","Ssh","Chor","Pay","Jum","Shan","Yak"],
        datasets: [{
            label: "Faollik",
            data: [40, 45, 38, 60, 55, 72, 50],
            borderColor: "#3b82f6",
            backgroundColor: gradient,
            borderWidth: 3,
            tension: 0.4,
            pointRadius: 4,
            pointBackgroundColor: "#3b82f6"
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend:{ labels:{ color:"#bcd0ff" }}},
        scales: {
            y: { ticks:{ color:"#90a4c6" }, grid:{ color:"rgba(255,255,255,0.04)"} },
            x: { ticks:{ color:"#90a4c6" }, grid:{ display:false }}
        }
    }
});



/***********************
  PRIORITY DONUT CHART
************************/
new Chart(document.getElementById("priorityChart"), {
    type: "doughnut",
    data: {
        labels: ["Urgent", "High", "Normal", "Low"],
        datasets: [{
            data: [25, 40, 25, 10],
            backgroundColor: ["#ef4444","#f97316","#3b82f6","#94a3b8"],
            borderWidth: 0
        }]
    },
    options: {
        cutout: "65%",
        plugins:{ legend:{ labels:{ color:"#bcd0ff" }}}
    }
});


/***********************
  SOLAR PANEL BAR CHART
************************/
new Chart(document.getElementById("solarChart"), {
    type: "bar",
    data: {
        labels: ["09:00","10:00","11:00","12:00","13:00"],
        datasets: [{
            label: "kW",
            data: [3,4,5,6,5],
            backgroundColor: "#facc15",
            borderRadius: 6
        }]
    },
    options: {
        plugins:{ legend:{ labels:{ color:"#bcd0ff" }}},
        scales: {
            y:{ ticks:{ color:"#90a4c6" }, grid:{ color:"rgba(255,255,255,0.04)" }},
            x:{ ticks:{ color:"#90a4c6" }, grid:{ display:false }}
        }
    }
});


/***********************
  SALARY CHART
************************/
new Chart(document.getElementById("salaryChart"), {
    type: "line",
    data: {
        labels: ["Yan","Fev","Mar","Apr","May","Iyun"],
        datasets: [{
            label: "So'm",
            data: [400, 600, 700, 500, 950, 850],
            borderColor: "#22c55e",
            borderWidth: 3,
            pointRadius: 4,
            tension: 0.4,
            backgroundColor: "rgba(34,197,94,0.12)"
        }]
    },
    options: {
        plugins:{ legend:{ labels:{ color:"#bcd0ff" }}},
        scales: {
            y:{ ticks:{ color:"#90a4c6" }, grid:{ color:"rgba(255,255,255,0.04)" }},
            x:{ ticks:{ color:"#90a4c6" }, grid:{ display:false }}
        }
    }
});

</script>

{% endblock %}
